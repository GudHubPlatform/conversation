<div class="chat">
    ${
        conversation.messages.length ?
        conversation.messages.reduce((html, message) => {
            return html + `
                ${
                    new Date(message.timestamp).getDate() !== new Date(conversation.messages[conversation.messages.indexOf(message) - 1]?.timestamp).getDate() ? `
                        <div class="date"><span>${new Date(message.timestamp).toLocaleDateString("en-US", {
                            weekday: "long",
                            month: "long",
                            day: "numeric",
                          })}</span></div>
                    ` : ''
                }
                <div class="message ${activeUserId == message.user_id ? 'me' : ''}">
                    <div class="user">
                        <div class="messenger">
                            ${
                                message.messenger === 'telegram' ? '<img src="https://gudhub.com/modules/conversation/public/images/telegram.svg" alt="Telegram" />' : ''
                            }
                            ${
                                message.messenger === 'viber' ? '<img src="https://gudhub.com/modules/conversation/public/images/viber.svg" alt="Viber" />' : ''
                            }
                            ${
                                message.messenger === 'facebook' ? '<img src="https://gudhub.com/modules/conversation/public/images/facebook.svg" alt="Facebook" />' : ''
                            }
                            ${
                                message.messenger === 'slack' ? '<svg width="18px" enable-background="new 0 0 2447.6 2452.5" viewBox="0 0 2447.6 2452.5" xmlns="http://www.w3.org/2000/svg"><g clip-rule="evenodd" fill-rule="evenodd"><path d="m897.4 0c-135.3.1-244.8 109.9-244.7 245.2-.1 135.3 109.5 245.1 244.8 245.2h244.8v-245.1c.1-135.3-109.5-245.1-244.9-245.3.1 0 .1 0 0 0m0 654h-652.6c-135.3.1-244.9 109.9-244.8 245.2-.2 135.3 109.4 245.1 244.7 245.3h652.7c135.3-.1 244.9-109.9 244.8-245.2.1-135.4-109.5-245.2-244.8-245.3z" fill="#36c5f0"/><path d="m2447.6 899.2c.1-135.3-109.5-245.1-244.8-245.2-135.3.1-244.9 109.9-244.8 245.2v245.3h244.8c135.3-.1 244.9-109.9 244.8-245.3zm-652.7 0v-654c.1-135.2-109.4-245-244.7-245.2-135.3.1-244.9 109.9-244.8 245.2v654c-.2 135.3 109.4 245.1 244.7 245.3 135.3-.1 244.9-109.9 244.8-245.3z" fill="#2eb67d"/><path d="m1550.1 2452.5c135.3-.1 244.9-109.9 244.8-245.2.1-135.3-109.5-245.1-244.8-245.2h-244.8v245.2c-.1 135.2 109.5 245 244.8 245.2zm0-654.1h652.7c135.3-.1 244.9-109.9 244.8-245.2.2-135.3-109.4-245.1-244.7-245.3h-652.7c-135.3.1-244.9 109.9-244.8 245.2-.1 135.4 109.4 245.2 244.7 245.3z" fill="#ecb22e"/><path d="m0 1553.2c-.1 135.3 109.5 245.1 244.8 245.2 135.3-.1 244.9-109.9 244.8-245.2v-245.2h-244.8c-135.3.1-244.9 109.9-244.8 245.2zm652.7 0v654c-.2 135.3 109.4 245.1 244.7 245.3 135.3-.1 244.9-109.9 244.8-245.2v-653.9c.2-135.3-109.4-245.1-244.7-245.3-135.4 0-244.9 109.8-244.8 245.1 0 0 0 .1 0 0" fill="#e01e5a"/></g></svg>' : ''
                            }
                        </div>
                        <conversation-avatar app-id="${appId}" name="${conversation.users.find(user => user.user_id == message.user_id)?.fullname}" url="${conversation.users.find(user => user.user_id == message.user_id)?.avatar_512}"></conversation-avatar>
                    </div>
                    <div class="content">
                        <div class="header">
                            <span class="name">${conversation.users.find(user => user.user_id == message.user_id)?.fullname || 'Not Found'}</span>
                            <span class="page">${message.page_name}</span>
                            <span class="time">
                                ${new Date(message.timestamp).toLocaleTimeString(navigator.language, {
                                    hour: "2-digit",
                                    minute: "2-digit",
                                  })}
                            </span>
                        </div>
                        <p class="message">
                            ${ !message.type ? message.content : '' }
                            ${ message.type === 'image' ? `<img src="${message.content}" alt="">` : ''}
                            ${ message.type === 'video' ? `<video src="${message.content}" controls></video>` : ''}
                            ${ message.type === 'audio' ? `<audio src="${message.content}" controls></audio>` : ''}
                            ${ message.type === 'file' ? `<a href="${message.content}" download>Download file</a>` : ''}
                        </p>
                    </div>
                </div>
            `
        }, '') : '<div class="date"><span>No Messages Found</span></div>'
    }
</div>