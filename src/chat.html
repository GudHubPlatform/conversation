<div class="multi-chat">
    <div class="chat">
        ${
            conversation.messages.reduce((html, message) => {
                return html + `
                    ${
                        new Date(message.timestamp).getDate() !== new Date(conversation.messages[conversation.messages.indexOf(message) - 1]?.timestamp).getDate() ? `
                            <div class="date"><span>${new Date(message.timestamp).toLocaleDateString("en-US", {
                                weekday: "long",
                                month: "long",
                                day: "numeric",
                              })}</span></div>
                        ` : ''
                    }
                    <div class="message ${activeUserId == message.user_id ? 'me' : ''}">
                        <div class="user">
                            <div class="messenger">
                                ${
                                    message.messenger === 'telegram' ? '<img src="/conversation/public/images/telegram.svg" alt="Telegram" />' : ''
                                }
                                ${
                                    message.messenger === 'viber' ? '<img src="/conversation/public/images/viber.svg" alt="Viber" />' : ''
                                }
                                ${
                                    message.messenger === 'facebook' ? '<img src="/conversation/public/images/facebook.svg" />' : ''
                                }
                            </div>
                            <div class="avatar">
                                <img src="${conversation.users.find(user => user.user_id == message.user_id)?.avatar_512}" alt="">
                            </div>
                        </div>
                        <div class="content">
                            <div class="header">
                                <span class="name">${conversation.users.find(user => user.user_id == message.user_id)?.fullname || 'Not Found'}</span>
                                <span class="time">
                                    ${new Date(message.timestamp).toLocaleTimeString(navigator.language, {
                                        hour: "2-digit",
                                        minute: "2-digit",
                                      })}
                                </span>
                            </div>
                            <p class="message">
                                ${ message.content }
                            </p>
                        </div>
                    </div>
                `
            }, '')
        }
    </div>
    <form onsubmit="sendMessage()" class="form">
        <textarea class="disable-gudhub-styles"></textarea>
        <div class="form__footer">
            <select class="messenger-select" name="messenger">
                <option value="telegram" selected>Telegram</option>
                <option value="viber">Viber</option>
                <option value="facebook">Facebook</option>
            </select>
            <button class="gh-btn inline gh-btn-blue gh-btn-bg" type="submit">Send</button>
        </div>
    </form>
</div>