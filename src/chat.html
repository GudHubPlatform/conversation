<div class="multi-chat">
    <div class="chat">
        ${
            conversation.messages ?
            conversation.messages.reduce((html, message) => {
                return html + `
                    ${
                        new Date(message.timestamp).getDate() !== new Date(conversation.messages[conversation.messages.indexOf(message) - 1]?.timestamp).getDate() ? `
                            <div class="date"><span>${new Date(message.timestamp).toLocaleDateString("en-US", {
                                weekday: "long",
                                month: "long",
                                day: "numeric",
                              })}</span></div>
                        ` : ''
                    }
                    <div class="message ${activeUserId == message.user_id ? 'me' : ''}">
                        <div class="user">
                            <div class="messenger">
                                ${
                                    message.messenger === 'telegram' ? '<img src="https://gudhub.com/modules/conversation/public/images/telegram.svg" alt="Telegram" />' : ''
                                }
                                ${
                                    message.messenger === 'viber' ? '<img src="https://gudhub.com/modules/conversation/public/images/viber.svg" alt="Viber" />' : ''
                                }
                                ${
                                    message.messenger === 'facebook' ? '<img src="https://gudhub.com/modules/conversation/public/images/facebook.svg" alt="Facebook" />' : ''
                                }
                            </div>
                            <conversation-avatar app-id="${appId}" name="${conversation.users.find(user => user.user_id == message.user_id)?.fullname}" url="${conversation.users.find(user => user.user_id == message.user_id)?.avatar_512}"></conversation-avatar>
                        </div>
                        <div class="content">
                            <div class="header">
                                <span class="name">${conversation.users.find(user => user.user_id == message.user_id)?.fullname || 'Not Found'}</span>
                                <span class="page">${message.page_name}</span>
                                <span class="time">
                                    ${new Date(message.timestamp).toLocaleTimeString(navigator.language, {
                                        hour: "2-digit",
                                        minute: "2-digit",
                                      })}
                                </span>
                            </div>
                            <p class="message">
                                ${ !message.type ? message.content : '' }
                                ${ message.type === 'image' ? `<img src="${message.content}" alt="">` : ''}
                                ${ message.type === 'video' ? `<video src="${message.content}" controls></video>` : ''}
                                ${ message.type === 'audio' ? `<audio src="${message.content}" controls></audio>` : ''}
                                ${ message.type === 'file' ? `<a href="${message.content}" download>Download file</a>` : ''}
                            </p>
                        </div>
                    </div>
                `
            }, '') : ''
        }
    </div>
    <div class="form_wrapper">
        <label class="upload">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21.586 10.461l-10.05 10.075c-1.95 1.949-5.122 1.949-7.071 0s-1.95-5.122 0-7.072l10.628-10.585c1.17-1.17 3.073-1.17 4.243 0 1.169 1.17 1.17 3.072 0 4.242l-8.507 8.464c-.39.39-1.024.39-1.414 0s-.39-1.024 0-1.414l7.093-7.05-1.415-1.414-7.093 7.049c-1.172 1.172-1.171 3.073 0 4.244s3.071 1.171 4.242 0l8.507-8.464c.977-.977 1.464-2.256 1.464-3.536 0-2.769-2.246-4.999-5-4.999-1.28 0-2.559.488-3.536 1.465l-10.627 10.583c-1.366 1.368-2.05 3.159-2.05 4.951 0 3.863 3.13 7 7 7 1.792 0 3.583-.684 4.95-2.05l10.05-10.075-1.414-1.414z"/></svg>
            <input accept="image/*, video/*, audio/*, .pdf" type="file">
        </label>
        <form onsubmit="sendMessage()" class="form">
            <textarea minlength="1" class="message_box disable-gudhub-styles"></textarea>
            <div class="form__footer">
                <select class="messenger-select" name="messenger">
                    ${
                        model.data_model.messengers.reduce((html, messenger) => {
                            return html + `
                                <option value="${messenger.messenger_name}"><span>${messenger.messenger_name}</span> - ${messenger.messenger_settings.page_name}</option>
                            `;
                        }, '')
                    }
                </select>
                <div class="chat_loader">
                    <span></span>
                </div>
                <button class="gh-btn inline gh-btn-blue gh-btn-bg" type="submit">Send</button>
            </div>
        </form>
    </div>
</div>